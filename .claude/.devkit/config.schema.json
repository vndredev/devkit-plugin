{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DevKit Plugin Config",
  "type": "object",
  "required": ["project"],
  "properties": {
    "project": {
      "type": "object",
      "description": "Project information",
      "required": ["name", "type"],
      "properties": {
        "name": { "type": "string", "description": "Project name" },
        "type": {
          "type": "string",
          "enum": ["python", "node", "nextjs", "typescript", "javascript", "plugin"],
          "description": "Project type (python, node-based, or Claude plugin)"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+",
          "default": "0.0.0",
          "description": "Semantic version (starting point for releases)"
        },
        "slogan": {
          "type": "string",
          "description": "Short tagline for the project"
        },
        "description": {
          "type": "string",
          "description": "Brief project description"
        },
        "principles": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Project principles (KISS, YAGNI, etc.)"
        }
      }
    },
    "hooks": {
      "type": "object",
      "description": "Hook configuration",
      "properties": {
        "session": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "show_git_status": { "type": "boolean", "default": true }
          }
        },
        "validate": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "block_force_push": { "type": "boolean", "default": true },
            "block_dangerous_gh": {
              "type": "boolean",
              "default": true,
              "description": "Block dangerous gh CLI commands (repo delete, secret delete)"
            }
          }
        },
        "format": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "auto_format": { "type": "boolean", "default": true },
            "arch_check": {
              "type": "boolean",
              "default": true,
              "description": "Check architecture violations after src/ file changes"
            },
            "auto_sync_arch": {
              "type": "boolean",
              "default": true,
              "description": "Auto-update ARCHITECTURE.md when config or arch files change"
            }
          }
        },
        "plan": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "instructions": {
              "type": "array",
              "items": { "type": "string" },
              "default": [],
              "description": "Custom implementation phase instructions (empty = use defaults)"
            }
          }
        }
      }
    },
    "git": {
      "type": "object",
      "properties": {
        "protected_branches": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["main"],
          "description": "Branches protected from force push"
        },
        "conventions": {
          "type": "object",
          "description": "Git naming conventions for commits and branches",
          "properties": {
            "types": {
              "type": "array",
              "items": { "type": "string" },
              "default": ["feat", "fix", "chore", "refactor", "test", "docs", "perf", "ci"],
              "description": "Allowed commit/branch types"
            },
            "scopes": {
              "type": "object",
              "description": "Scope validation configuration",
              "properties": {
                "mode": {
                  "type": "string",
                  "enum": ["strict", "warn", "off"],
                  "default": "strict",
                  "description": "Validation mode: strict=error, warn=warning, off=disabled"
                },
                "allowed": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Allowed scope names for commits"
                },
                "internal": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": ["internal", "review", "ci", "deps"],
                  "description": "Internal scopes (skip release notes)"
                }
              }
            },
            "branch_pattern": {
              "type": "string",
              "default": "{type}/{description}",
              "description": "Branch naming pattern"
            }
          }
        }
      }
    },
    "github": {
      "type": "object",
      "description": "GitHub repository configuration",
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "GitHub repository URL"
        },
        "visibility": {
          "type": "string",
          "enum": ["public", "private", "internal"],
          "default": "public",
          "description": "Repository visibility"
        },
        "pr": {
          "type": "object",
          "description": "Pull request settings",
          "properties": {
            "auto_merge": {
              "type": "boolean",
              "default": false,
              "description": "Enable auto-merge when PR is created (requires branch protection)"
            },
            "delete_branch": {
              "type": "boolean",
              "default": true,
              "description": "Delete branch after merge"
            },
            "merge_method": {
              "type": "string",
              "enum": ["squash", "merge", "rebase"],
              "default": "squash",
              "description": "Merge method: squash (recommended), merge, or rebase"
            }
          }
        }
      }
    },
    "deployment": {
      "type": "object",
      "description": "Deployment platform configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable deployment features"
        },
        "platform": {
          "type": "string",
          "enum": ["vercel", "railway", "render", "fly", "netlify"],
          "description": "Primary deployment platform"
        },
        "platforms": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Available deployment platforms"
        },
        "framework": {
          "type": "string",
          "description": "Framework type (nextjs, other)"
        },
        "env_sync": {
          "type": "boolean",
          "default": true,
          "description": "Sync environment variables to platform"
        },
        "production_domain": {
          "type": "string",
          "description": "Production domain URL"
        },
        "note": {
          "type": "string",
          "description": "Deployment notes or restrictions"
        }
      }
    },
    "arch": {
      "type": "object",
      "description": "Clean Architecture layer configuration",
      "properties": {
        "layers": {
          "type": "object",
          "description": "Layer definitions with tier numbers, patterns, and descriptions",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "tier": {
                "type": "integer",
                "minimum": 0,
                "description": "Layer tier (0=innermost, higher=outer)"
              },
              "patterns": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Glob patterns for layer files (e.g., src/core/**)"
              },
              "description": {
                "type": "string",
                "description": "Human-readable layer description for documentation"
              }
            },
            "required": ["tier"]
          }
        }
      }
    },
    "linters": {
      "type": "object",
      "description": "Linter configuration with presets",
      "properties": {
        "preset": {
          "type": "string",
          "enum": ["strict", "relaxed", "minimal"],
          "default": "strict",
          "description": "Linter preset (strict, relaxed, minimal)"
        },
        "overrides": {
          "type": "object",
          "description": "Override preset values",
          "additionalProperties": true
        }
      }
    },
    "managed": {
      "type": "object",
      "description": "Managed files manifest - all generated files",
      "properties": {
        "linters": {
          "type": "object",
          "description": "Linter config files",
          "additionalProperties": {
            "$ref": "#/$defs/managedFile"
          }
        },
        "github": {
          "type": "object",
          "description": "GitHub workflows and templates",
          "additionalProperties": {
            "$ref": "#/$defs/managedFile"
          }
        },
        "docs": {
          "type": "object",
          "description": "Documentation files",
          "additionalProperties": {
            "$ref": "#/$defs/managedDoc"
          }
        },
        "ignore": {
          "type": "object",
          "description": "Ignore files (.gitignore, etc)",
          "additionalProperties": {
            "$ref": "#/$defs/managedIgnore"
          }
        }
      }
    },
    "testing": {
      "type": "object",
      "description": "Test configuration and requirements",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable test requirement checks"
        },
        "framework": {
          "type": "string",
          "enum": ["pytest", "jest", "vitest"],
          "description": "Test framework"
        },
        "coverage": {
          "type": "object",
          "description": "Coverage requirements",
          "properties": {
            "minimum": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "default": 80,
              "description": "Minimum coverage percentage"
            },
            "exclude": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Patterns to exclude from coverage"
            }
          }
        },
        "required_modules": {
          "type": "object",
          "description": "Modules that must have tests with their required functions",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" },
            "description": "List of functions that must be tested"
          }
        }
      }
    },
    "changelog": {
      "type": "object",
      "description": "Changelog generation settings",
      "properties": {
        "audience": {
          "type": "string",
          "enum": ["developer", "user"],
          "default": "developer",
          "description": "Target audience: developer (technical, shows scopes) or user (simple, clean)"
        },
        "sections": {
          "type": "object",
          "description": "Custom section headers per commit type",
          "properties": {
            "feat": { "type": "string", "default": "Added" },
            "fix": { "type": "string", "default": "Fixed" },
            "refactor": { "type": "string", "default": "Changed" },
            "perf": { "type": "string", "default": "Changed" }
          }
        }
      }
    }
  },
  "$defs": {
    "managedFile": {
      "type": "object",
      "properties": {
        "template": { "type": "string", "description": "Template path relative to templates/" },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["template"]
    },
    "managedDoc": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["auto_sections", "auto_generate", "template"],
          "description": "auto_sections preserves CUSTOM blocks, auto_generate generates from config, template copies from plugin"
        },
        "template": {
          "type": "string",
          "description": "Template path for type=template (relative to templates/)"
        },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["type"]
    },
    "managedIgnore": {
      "type": "object",
      "properties": {
        "template": {
          "oneOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ],
          "description": "Single template or array to combine"
        },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["template"]
    }
  }
}
