{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DevKit Plugin Config",
  "type": "object",
  "required": ["project"],
  "properties": {
    "project": {
      "type": "object",
      "description": "Project information",
      "required": ["name", "type"],
      "properties": {
        "name": { "type": "string", "description": "Project name" },
        "type": {
          "type": "string",
          "enum": [
            "python",
            "node",
            "nextjs",
            "typescript",
            "javascript",
            "plugin"
          ],
          "description": "Project type (python, node-based, or Claude plugin)"
        },
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+",
          "default": "0.0.0",
          "description": "Semantic version (starting point for releases)"
        },
        "slogan": {
          "type": "string",
          "description": "Short tagline for the project"
        },
        "description": {
          "type": "string",
          "description": "Brief project description"
        },
        "principles": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Project principles (KISS, YAGNI, etc.)"
        }
      }
    },
    "hooks": {
      "type": "object",
      "description": "Hook configuration",
      "properties": {
        "session": {
          "type": "object",
          "description": "SessionStart hook - shows project status",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "show_git_status": { "type": "boolean", "default": true },
            "prompts": {
              "type": "object",
              "description": "Customizable output templates",
              "properties": {
                "branch": {
                  "type": "string",
                  "default": "ðŸ“ {branch}",
                  "description": "Branch display template"
                },
                "staged": {
                  "type": "string",
                  "default": "âš¡{count} staged",
                  "description": "Staged files template"
                },
                "modified": {
                  "type": "string",
                  "default": "âœï¸{count} modified",
                  "description": "Modified files template"
                },
                "untracked": {
                  "type": "string",
                  "default": "â“{count} untracked",
                  "description": "Untracked files template"
                },
                "hint": {
                  "type": "string",
                  "default": "Use `/dk` for commands, `/dk dev` for workflow",
                  "description": "Help hint"
                },
                "system_warning": {
                  "type": "string",
                  "default": "âš ï¸ Project has issues - check with /dk plugin check",
                  "description": "Warning shown directly to user when issues detected"
                }
              }
            }
          }
        },
        "validate": {
          "type": "object",
          "description": "PreToolUse hook - validates git/gh commands",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "block_force_push": { "type": "boolean", "default": true },
            "block_dangerous_gh": {
              "type": "boolean",
              "default": true,
              "description": "Block dangerous gh CLI commands (repo delete, secret delete)"
            },
            "prompts": {
              "type": "object",
              "description": "Customizable error messages",
              "properties": {
                "branch_invalid": {
                  "type": "string",
                  "default": "Branch '{branch}' should match: {pattern}",
                  "description": "Invalid branch name error"
                },
                "commit_invalid": {
                  "type": "string",
                  "default": "Commit should match: type(scope): message (types: {types})",
                  "description": "Invalid commit message error"
                },
                "scope_invalid": {
                  "type": "string",
                  "default": "Unknown scope '{scope}'. Allowed: {allowed}",
                  "description": "Invalid scope error"
                },
                "force_push_blocked": {
                  "type": "string",
                  "default": "Force push is blocked. Use --force-with-lease if needed.",
                  "description": "Force push blocked message"
                },
                "gh_blocked": {
                  "type": "string",
                  "default": "Blocked: '{cmd}' - too dangerous for automatic execution",
                  "description": "Blocked gh command message"
                },
                "pr_missing_body": {
                  "type": "string",
                  "default": "gh pr create requires --body with PR template",
                  "description": "Missing PR body error"
                }
              }
            }
          }
        },
        "format": {
          "type": "object",
          "description": "PostToolUse hook - formats files and checks architecture",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "auto_format": { "type": "boolean", "default": true },
            "arch_check": {
              "type": "boolean",
              "default": true,
              "description": "Check architecture violations after src/ file changes"
            },
            "auto_sync_arch": {
              "type": "boolean",
              "default": true,
              "description": "Auto-update ARCHITECTURE.md when config or arch files change"
            },
            "prompts": {
              "type": "object",
              "description": "Customizable output templates",
              "properties": {
                "formatted": {
                  "type": "string",
                  "default": "âœ“ Formatted: {file}",
                  "description": "File formatted message"
                },
                "test_reminder": {
                  "type": "string",
                  "default": "ðŸ’¡ New file - consider adding: tests/{file}",
                  "description": "Test reminder for new files"
                },
                "arch_violation": {
                  "type": "string",
                  "default": "âš ï¸ Arch violation: {message}",
                  "description": "Architecture violation warning"
                },
                "arch_synced": {
                  "type": "string",
                  "default": "ðŸ“„ Updated docs/ARCHITECTURE.md",
                  "description": "Architecture doc updated message"
                }
              }
            }
          }
        },
        "plan": {
          "type": "object",
          "description": "PostToolUse hook - guides planning and implementation phases",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "planning": {
              "type": "object",
              "description": "Guidelines for creating plans (before ExitPlanMode)",
              "properties": {
                "requirements": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Things to check/consider while planning"
                },
                "structure": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Sections a plan should contain"
                }
              }
            },
            "implementation": {
              "type": "object",
              "description": "Instructions shown after ExitPlanMode",
              "properties": {
                "header": {
                  "type": "string",
                  "default": "## Implementation Phase",
                  "description": "Section header"
                },
                "instructions": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Implementation steps (empty = use defaults)"
                }
              }
            },
            "hints": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Project-specific planning hints (shown in both phases)"
            }
          }
        }
      }
    },
    "git": {
      "type": "object",
      "properties": {
        "protected_branches": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["main"],
          "description": "Branches protected from force push"
        },
        "conventions": {
          "type": "object",
          "description": "Git naming conventions for commits and branches",
          "properties": {
            "types": {
              "type": "array",
              "items": { "type": "string" },
              "default": [
                "feat",
                "fix",
                "chore",
                "refactor",
                "test",
                "docs",
                "perf",
                "ci"
              ],
              "description": "Allowed commit/branch types"
            },
            "scopes": {
              "type": "object",
              "description": "Scope validation configuration",
              "properties": {
                "mode": {
                  "type": "string",
                  "enum": ["strict", "warn", "off"],
                  "default": "strict",
                  "description": "Validation mode: strict=error, warn=warning, off=disabled"
                },
                "allowed": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Allowed scope names for commits"
                },
                "internal": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": ["internal", "review", "ci", "deps"],
                  "description": "Internal scopes (skip release notes)"
                }
              }
            },
            "branch_pattern": {
              "type": "string",
              "default": "{type}/{description}",
              "description": "Branch naming pattern"
            }
          }
        }
      }
    },
    "github": {
      "type": "object",
      "description": "GitHub repository configuration",
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "GitHub repository URL"
        },
        "visibility": {
          "type": "string",
          "enum": ["public", "private", "internal"],
          "default": "public",
          "description": "Repository visibility"
        },
        "pr": {
          "type": "object",
          "description": "Pull request settings",
          "properties": {
            "auto_merge": {
              "type": "boolean",
              "default": false,
              "description": "Enable auto-merge when PR is created (requires branch protection)"
            },
            "delete_branch": {
              "type": "boolean",
              "default": true,
              "description": "Delete branch after merge"
            },
            "merge_method": {
              "type": "string",
              "enum": ["squash", "merge", "rebase"],
              "default": "squash",
              "description": "Merge method: squash (recommended), merge, or rebase"
            }
          }
        },
        "protection": {
          "type": "object",
          "description": "Branch protection ruleset configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable branch protection ruleset"
            },
            "require_reviews": {
              "type": "integer",
              "minimum": 0,
              "maximum": 6,
              "default": 1,
              "description": "Number of required PR reviews (0 to disable)"
            },
            "linear_history": {
              "type": "boolean",
              "default": true,
              "description": "Require linear commit history (no merge commits)"
            },
            "admin_bypass": {
              "type": "boolean",
              "default": true,
              "description": "Allow admins to bypass protection (requires Pro/Team+)"
            },
            "dismiss_stale_reviews": {
              "type": "boolean",
              "default": false,
              "description": "Dismiss stale reviews when new commits are pushed"
            }
          }
        }
      }
    },
    "deployment": {
      "type": "object",
      "description": "Deployment platform configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable deployment features"
        },
        "platform": {
          "type": "string",
          "enum": ["vercel", "railway", "render", "fly", "netlify"],
          "description": "Primary deployment platform"
        },
        "platforms": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Available deployment platforms"
        },
        "framework": {
          "type": "string",
          "description": "Framework type (nextjs, other)"
        },
        "env_sync": {
          "type": "boolean",
          "default": true,
          "description": "Sync environment variables to platform"
        },
        "production_domain": {
          "type": "string",
          "description": "Production domain URL"
        },
        "note": {
          "type": "string",
          "description": "Deployment notes or restrictions"
        }
      }
    },
    "arch": {
      "type": "object",
      "description": "Clean Architecture layer configuration",
      "properties": {
        "layers": {
          "type": "object",
          "description": "Layer definitions with tier numbers, patterns, and descriptions",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "tier": {
                "type": "integer",
                "minimum": 0,
                "description": "Layer tier (0=innermost, higher=outer)"
              },
              "patterns": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Glob patterns for layer files (e.g., src/core/**)"
              },
              "description": {
                "type": "string",
                "description": "Human-readable layer description for documentation"
              }
            },
            "required": ["tier"]
          }
        }
      }
    },
    "linters": {
      "type": "object",
      "description": "Linter configuration with presets",
      "properties": {
        "preset": {
          "type": "string",
          "enum": ["strict", "relaxed", "minimal"],
          "default": "strict",
          "description": "Linter preset (strict, relaxed, minimal)"
        },
        "overrides": {
          "type": "object",
          "description": "Override preset values",
          "additionalProperties": true
        }
      }
    },
    "managed": {
      "type": "object",
      "description": "Managed files manifest - all generated files",
      "properties": {
        "config": {
          "type": "object",
          "description": "Config files (schema, etc.)",
          "additionalProperties": {
            "$ref": "#/$defs/managedFile"
          }
        },
        "linters": {
          "type": "object",
          "description": "Linter config files",
          "additionalProperties": {
            "$ref": "#/$defs/managedFile"
          }
        },
        "github": {
          "type": "object",
          "description": "GitHub workflows and templates",
          "additionalProperties": {
            "$ref": "#/$defs/managedFile"
          }
        },
        "docs": {
          "type": "object",
          "description": "Documentation files",
          "additionalProperties": {
            "$ref": "#/$defs/managedDoc"
          }
        },
        "ignore": {
          "type": "object",
          "description": "Ignore files (.gitignore, etc)",
          "additionalProperties": {
            "$ref": "#/$defs/managedIgnore"
          }
        }
      }
    },
    "testing": {
      "type": "object",
      "description": "Test configuration and requirements",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable test requirement checks"
        },
        "framework": {
          "type": "string",
          "enum": ["pytest", "jest", "vitest"],
          "description": "Test framework"
        },
        "coverage": {
          "type": "object",
          "description": "Coverage requirements",
          "properties": {
            "minimum": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "default": 80,
              "description": "Minimum coverage percentage"
            },
            "exclude": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Patterns to exclude from coverage"
            }
          }
        },
        "required_modules": {
          "type": "object",
          "description": "Modules that must have tests with their required functions",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" },
            "description": "List of functions that must be tested"
          }
        }
      }
    },
    "changelog": {
      "type": "object",
      "description": "Changelog generation settings",
      "properties": {
        "audience": {
          "type": "string",
          "enum": ["developer", "user"],
          "default": "developer",
          "description": "Target audience: developer (technical, shows scopes) or user (simple, clean)"
        },
        "sections": {
          "type": "object",
          "description": "Custom section headers per commit type",
          "properties": {
            "feat": { "type": "string", "default": "Added" },
            "fix": { "type": "string", "default": "Fixed" },
            "refactor": { "type": "string", "default": "Changed" },
            "perf": { "type": "string", "default": "Changed" }
          }
        }
      }
    },
    "consistency": {
      "type": "object",
      "description": "Project consistency validation rules",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable consistency checks"
        },
        "rules": {
          "type": "object",
          "description": "Individual rule configurations",
          "properties": {
            "module_tests": {
              "type": "object",
              "description": "Check that source modules have test files",
              "properties": {
                "enabled": { "type": "boolean", "default": true },
                "patterns": {
                  "type": "object",
                  "description": "Source pattern to test pattern mapping",
                  "additionalProperties": { "type": "string" },
                  "default": { "src/lib/*.py": "tests/test_{stem}.py" }
                },
                "exclude": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": ["__init__.py"],
                  "description": "File names to exclude from checks"
                }
              }
            },
            "hook_handlers": {
              "type": "object",
              "description": "Check that enabled hooks have handler files",
              "properties": {
                "enabled": { "type": "boolean", "default": true }
              }
            },
            "config_schema": {
              "type": "object",
              "description": "Check that config keys exist in schema",
              "properties": {
                "enabled": { "type": "boolean", "default": true }
              }
            },
            "skill_routes": {
              "type": "object",
              "description": "Check that skill routes reference existing docs",
              "properties": {
                "enabled": { "type": "boolean", "default": true }
              }
            },
            "custom_imports": {
              "type": "object",
              "description": "Custom import rules (deny/require)",
              "properties": {
                "enabled": { "type": "boolean", "default": false },
                "deny": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Forbidden imports: 'src/hooks/* -> @prisma/client'"
                },
                "require": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Required imports (future)"
                }
              }
            }
          }
        }
      }
    },
    "webhooks": {
      "type": "object",
      "description": "Webhook tunnel configuration for local development",
      "properties": {
        "ngrok": {
          "type": "object",
          "description": "ngrok tunnel configuration",
          "properties": {
            "domain": {
              "type": "string",
              "description": "Static ngrok domain (e.g., your-app.ngrok-free.app)"
            },
            "port": {
              "type": "integer",
              "default": 3000,
              "description": "Local port to forward to"
            }
          }
        },
        "services": {
          "type": "object",
          "description": "Webhook service configurations",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "Webhook endpoint path (e.g., /api/webhooks/stripe)"
              },
              "provider": {
                "type": "string",
                "enum": ["stripe", "livekit", "clerk", "resend", "custom"],
                "description": "Service provider for CLI integration"
              },
              "events": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Events to listen for (provider-specific)"
              }
            },
            "required": ["path"]
          }
        }
      }
    }
  },
  "$defs": {
    "managedFile": {
      "type": "object",
      "properties": {
        "template": {
          "type": "string",
          "description": "Template path relative to templates/"
        },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["template"]
    },
    "managedDoc": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["auto_sections", "auto_generate", "template"],
          "description": "auto_sections preserves CUSTOM blocks, auto_generate generates from config, template copies from plugin"
        },
        "template": {
          "type": "string",
          "description": "Template path for type=template (relative to templates/)"
        },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["type"]
    },
    "managedIgnore": {
      "type": "object",
      "properties": {
        "template": {
          "oneOf": [
            { "type": "string" },
            { "type": "array", "items": { "type": "string" } }
          ],
          "description": "Single template or array to combine"
        },
        "enabled": { "type": "boolean", "default": true }
      },
      "required": ["template"]
    }
  }
}
